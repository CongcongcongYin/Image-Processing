im=imread('lenna512.bmp');
Qmat=[1,2,2,4,4,4,4,8,8,8,8,8,8,8,8,16;
      2,2,2,4,4,4,4,8,8,8,8,8,8,8,8,16;
      2,2,2,4,4,4,4,8,8,8,8,8,8,8,8,16;
      4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,16;
      4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,16;
      4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,16;
      4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16;
      16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16;];
file_name='Question4_1.dat';
N=8;
i=1;
for QP=1:14:99
[rate] = compress_im(im, Qmat, QP, N, file_name);
[imo] = decompress_im(Qmat, QP, N, file_name);
psnr = calculate_psnr(imo, im);
rate_all(i)=rate;
psnr_all(i)=psnr;
i=i+1;
end
plot(rate_all,psnr_all);
xlabel('bit rate');
ylabel('psnr')
grid on;